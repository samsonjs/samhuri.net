<!doctype html>
<meta charset=utf-8>
<meta name=viewport content=width=device-width>
<title>A preview of Mach-O file generation :: samhuri.net</title>
<link rel=stylesheet href=../assets/blog.css>
<script>
var _gaq = _gaq || [];
_gaq.push( ['_setAccount', 'UA-214054-5']
         , ['_trackPageview']
         );

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
if (document.addEventListener) {
  document.addEventListener('DOMContentLoaded', ready, false)
} else if (window.attachEvent) {
  window.attachEvent('onload', ready)
}
function ready() {
  function html(id, h) {
    document.getElementById(id).innerHTML = h
  }

  var discussion = document.getElementById('discussion')
    , discussionToggle = document.getElementById('discussion-toggle')
    , hidden = true
  discussionToggle.onclick = function() {
    hidden = !hidden
    discussion.style.display = hidden ? 'none' : 'block'
    discussionToggle.innerHTML = hidden ? '&darr; show discussion &darr;' : '&uarr; hide discussion &uarr;'
    SJS.request({uri: 'http://bohodev.net:8000/comments/'}, function(err, body) {
      html('comments', body)
    })
  }
}
</script>
<header>
  <h1><a href=index.html>sjs' blog</a></h1>
</header>
<nav id=breadcrumbs><a href=../>samhuri.net</a> &rarr; <a href=index.html>blog</a></nav>
<div id=posts>
  
  <article>
    <header>
      <h1><a href=a-preview-of-mach-o-file-generation.html>A preview of Mach-O file generation</a></h1>
      <time>January 20, 2010</time>
    </header>
    <p>This month I got back into an x86 compiler I started last May. It lives <a
href="https://github.com/samsonjs/compiler">on github</a>.</p>




<p>The code is a bit of a mess but it mostly works. It generates Mach object
files that are linked with gcc to produce executable binaries.</p>




<p>The Big Refactoring of January 2010 has come to an end and the tests pass
again, even if printing is broken it prints <i>something</i>, and more
importantly compiles test/test_huge.code into something that works.</p>




<p>After print is fixed I can clean up the code before implementing anything
new. I wasn't sure if I'd get back into this or not and am pretty excited
about it. I'm learning a lot from this project.</p>




<p>If you are following the Mach-O posts you might want to look at
asm/machofile.rb, a library for creating Mach-O files. Using it is quite
straightforward, an example is in asm/binary.rb, in the #output method.</p>




<p>Definitely time for bed now!</p>


    </article>
</div>
<div id=around>
  <a id=prev href=basics-of-the-mach-o-file-format.html>&larr; Basics of the Mach-O file format</a>
  <a id=next href=37signals-chalk-dissected.html>37signals' Chalk Dissected &rarr;</a>
  <br style=clear:both>
</div>
<div class=center><a id=discussion-toggle href=#>&darr; show discussion &darr;</a></div>
<div id=discussion>
  <div id=comment-form>
  <form method=post action=http://bohodev.net:8000/comment>
    <input name=from type=hidden value=a-preview-of-mach-o-file-generation.html>
    <p>Name: <input name=name size=30></p>
    <p>URL: <input name=url size=30></p>
    <p>Thoughts: <textarea name=body cols=40 rows=5></textarea></p>
    <p><input type=submit value=Add to discussion></p>
  </form>
  </div>
  <div id=comments>
    <img id=discussion-spinner src=../assets/spinner.gif>
  </div>
</div>
<footer>
  <a href=https://twitter.com/_sjs>@_sjs</a>
</footer>
